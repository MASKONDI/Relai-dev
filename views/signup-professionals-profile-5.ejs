<%- include('head')-%>

  <div class="wrapper dashboard">
    <nav class="navbar navbar-expand-lg d-block d-xs-none d-lg-none">
      <a class="navbar-brand" href="/index"><img src="images/logo-2.png"></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </button>
      <div class="user-right">
        <ul class="login-menu">
          <li class="dropdown"><a href="#" class="dropdown-toggle" type="button" id="dropdownMenuButton"
              data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src="images/recent-user-1.png"
                width="40" height="40" class="rounded-circle"> John <i class="fa fa-angle-down"
                aria-hidden="true"></i></a>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item" href="#">Setting</a>
              <a class="dropdown-item" href="#">Account</a>
              <a class="dropdown-item" href="#">Log Out</a>
            </div>
          </li>
        </ul>
      </div>
      <div class="collapse navbar-collapse" id="collapsibleNavbar">
        <ul class="navbar-nav">
          <li class="nav-item ">
            <a class="nav-link" href="/signup-professionals-profile"><img class="act-img" src="images/1-active.png"><img
                src="images/1.png">PERSONAL DETAILS </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/signup-professionals-profile-2"><img class="act-img"
                src="images/2-active.png"><img src="images/2.png"> OTHER DETAILS</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/signup-professionals-profile-3"><img class="act-img"
                src="images/3-active.png"><img src="images/3.png"> EDUCATION</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/signup-professionals-profile-4"><img class="act-img"
                src="images/4-active.png"><img src="images/4.png"> EMPLOYMENT HISTORY</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="/signup-professionals-profile-5"><img class="act-img"
                src="images/5-active.png"><img src="images/5.png"> REFERENCES</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/signup-professionals-profile-6"><img class="act-img"
                src="images/6-active.png"><img src="images/6.png"> PROFESSIONAL INDEMNITY
              INSURANCE</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/signup-professionals-profile-7"><img class="act-img"
                src="images/7-active.png"><img src="images/7.png"> LANGUAGE</a>
          </li>
        </ul>
      </div>
    </nav>


    <div class="dashboard-wpr">
      <div class="container-fluid">
        <div class="row content">
          <div class="col-sm-3 sidenav2 hidden-xs-down">
            <div class=" text-center">
              <div class="">
                <a href="/index"><img src="images/logo-2.png"></a>
              </div>

            </div>
            <ul class="dashboard-nav">
              <li class="completed">
                <a href="/signup-professionals-profile" class ="personal_detail_nev">
                  <img class="complete-img" src="images/checked.png">
                  <img class="act-img" src="images/1-active.png">
                  <img src="images/1.png">
                  PERSONAL DETAILS
                </a>
              </li>
              <li >
                <a href="javascript:void(0)" data-href="/signup-professionals-profile-2"class ="other_detail_nev"><img class="act-img" src="images/2-active.png"><img
                    src="images/2.png"> OTHER DETAILS</a>
              </li>
              <li>
                <a href="javascript:void(0)" data-href="/signup-professionals-profile-3" class ="education_detail_nev"><img class="act-img" src="images/3-active.png"><img
                    src="images/3.png"> EDUCATION</a>
              </li>
              <li >
                <a href="javascript:void(0)"  data-href="/signup-professionals-profile-4" class ="employment_detail_nev"><img
                    src="images/4.png"> EMPLOYMENT HISTORY</a>
              </li>

              <li class="active">
                <a href="javascript:void(0)"  data-href="/signup-professionals-profile-5" class ="refrence_detail_nev"><img class="act-img" src="images/5-active.png"><img
                    src="images/5.png"> REFERENCES</a>
              </li>
              <li  >
                <a href="javascript:void(0)"  data-href="/signup-professionals-profile-6" class ="indemnity_detail_nev"><img class="act-img" src="images/6-active.png"><img
                    src="images/6.png"> PROFESSIONAL INDEMNITY
                  INSURANCE</a>
              </li>
              <li>
                <a href="javascript:void(0)"  data-href="/signup-professionals-profile-7" class ="language_detail_nev"><img class="act-img" src="images/7-active.png"><img
                    src="images/7.png"> LANGUAGE</a>
              </li>
            </ul>
          </div>

          <div class="col-sm-12 col-lg-9">
            <div class=" dashboard-inner">
              <div class="row">
                <div class="col-sm-12 col-lg-9">
                  <div class="signup-header">
                    <!-- <p>START FOR FREE</p> -->

                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-12 col-lg-9">
                  <div class="signup-head">
                    <h3>References</h3>
                  </div>
                </div>
                <div class="col-sm-12 col-lg-3">
                  <div class="page-count">
                    <p> 5 of 7</p>
                  </div>
                </div>
              </div>
              <form action="/api/service_provider_reference" method="post" class="form form-section" id="form5">

                <% if(typeof err_msg!='undefined' ){ %>
                  <span class="error_validate flash_msg" style="color: red; padding-bottom: 20px;">
                    <%= err_msg %>
                  </span>
                  <% }%>
                    <% if(typeof success_msg!='undefined' ){ %>
                      <span class="succ_flash_msg" style="color: green;">
                        <%= success_msg %>
                      </span>
                      <% }%>
                      <%if(refrenceData==null){%>
                        <div class="row">
                          <div class="col-sm-12 col-lg-6">
                            <div class="input-box-size-fix3">
                              <input type="text" class="form-control text-field-size rs_reference_fullname" id="rs_reference_fullname" placeholder="Full name"
                                name="rs_reference_fullname" required value="">
                            </div>
                          </div>
                          <div class="col-sm-12 col-lg-6">
                            <div class="input-box-size-fix3">
                              <input type="text" class="form-control text-field-size rs_reference_job_title" id="" placeholder="Job Title"
                                name="rs_reference_job_title" required value="">
                            </div>
                          </div>
                        </div>


                        <div class="row">
                          <div class="col-sm-12 col-lg-6">
                            <div class="input-box-size-fix3">
                              <input type="text" class="form-control text-field-size rs_reference_organisation" id="" placeholder="Organisation"
                                name="rs_reference_organisation" required value="">
                            </div>
                          </div>
                          <div class="col-sm-12 col-lg-6">
                            <div class="input-box-size-fix3">
                              <input type="text" class="form-control text-field-size rs_reference_postal_code" id="" placeholder="Post Code"
                                name="rs_reference_postal_code" required value="">
                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-sm-12 col-lg-12">
                            <div class="">
                              <input type="text" class="form-control text-field rs_reference_address" id="" placeholder="Address"
                                name="rs_reference_address" required value="">
                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-sm-12 col-lg-6">
                            <div class="input-box-size-fix3">
                              <input type="number" class="form-control text-field-size rs_reference_telePhoneNumber" id="" placeholder="Telephone No."
                                name="rs_reference_telePhoneNumber" required value="">
                            </div>
                          </div>
                          <div class="col-sm-12 col-lg-6">
                            <div class="input-box-size-fix3">
                              <input type="email" class="form-control text-field-size rs_reference_emailid" id="" placeholder="Email ID"
                                name="rs_reference_emailid" required value="">
                            </div>
                          </div>
                        </div>


                        <div class="row">
                          <div class="col-sm-12 col-lg-4">
                            <div class="profile-notes">
                              <p>May we obtain this reference now?
                              </p>
                            </div>
                          </div>

                          <div class="col-sm-12 col-lg-2">
                            <div class="profile-radio">
                              <label class="radio-inline">
                                <input type="radio" name="rs_option_obtain_reference" onclick="javascript:yesnoCheck();"
                                  id="yesCheck" value="yes"     >
                                &nbsp;Yes&nbsp;&nbsp;
                              </label>
                              <label class="radio-inline">
                                <input type="radio" name="rs_option_obtain_reference" value="no"
                                  onclick="javascript:yesnoCheck();" id="noCheck" checked>
                                &nbsp;No&nbsp;&nbsp;
                              </label>
                            </div>
                          </div>

                          <div class="col-sm-12 col-lg-6" id="ifYes" style="display: none;">
                            <div class="input-box-size-fix3">
                              <input type="text" class="form-control text-field-size rs_reference_relationship" id=""
                                placeholder="Relationship(One must be work related)" name="rs_reference_relationship"  value="">
                            </div>
                          </div>
                        </div>


                        <div class="row">
                          <div class="col-6 col-sm-6 col-lg-6">
                            <div class="prev-btn float-left">
                              <a href="/signup-professionals-profile-4" class="btn previous-btn" style="width: 164px; ">
                                PREVIOUS</a>
                            </div>
                          </div>


                          <div class="col-6 col-sm-6 col-lg-6">
                            <div class="prev-btn float-right">
                              <!-- <a href="/signup-professionals-profile-6" class="btn btn-next" style="width: 164px;">
                        NEXT</a> -->
                        <input type="hidden" name="ref_id" value="" class="ref_id">
                              <button type="submit" class="btn btn-next" style="width: 164px;">
                                NEXT</button>
                            </div>
                            <%}else{%>
                              <div class="row">
                                <div class="col-sm-12 col-lg-6">
                                  <div class="input-box-size-fix3">
                                    <input type="text" class="form-control text-field-size " id="" placeholder="Full name"
                                      name="rs_reference_fullname" value="<%=refrenceData.rs_reference_fullname%>">
                                  </div>
                                </div>
                                <div class="col-sm-12 col-lg-6">
                                  <div class="input-box-size-fix3">
                                    <input type="text" class="form-control text-field-size " id="" placeholder="Job Title"
                                      name="rs_reference_job_title" value="<%=refrenceData.rs_reference_job_title%>">
                                  </div>
                                </div>
                              </div>
      
      
                              <div class="row">
                                <div class="col-sm-12 col-lg-6">
                                  <div class="input-box-size-fix3">
                                    <input type="text" class="form-control text-field-size " id="" placeholder="Organisation"
                                      name="rs_reference_organisation" value="<%=refrenceData.rs_reference_organisation%>">
                                  </div>
                                </div>
                                <div class="col-sm-12 col-lg-6">
                                  <div class="input-box-size-fix3">
                                    <input type="text" class="form-control text-field-size " id="" placeholder="Post Code"
                                      name="rs_reference_postal_code" value="<%=refrenceData.rs_reference_postal_code%>">
                                  </div>
                                </div>
                              </div>
      
                              <div class="row">
                                <div class="col-sm-12 col-lg-12">
                                  <div class="">
                                    <input type="text" class="form-control text-field" id="" placeholder="Address"
                                      name="rs_reference_address" value="<%=refrenceData.rs_reference_address%>">
                                  </div>
                                </div>
                              </div>
      
                              <div class="row">
                                <div class="col-sm-12 col-lg-6">
                                  <div class="input-box-size-fix3">
                                    <input type="text" class="form-control text-field-size " id="" placeholder="Telephone No."
                                      name="rs_reference_telePhoneNumber" value="<%=refrenceData.rs_reference_telePhoneNumber%>">
                                  </div>
                                </div>
                                <div class="col-sm-12 col-lg-6">
                                  <div class="input-box-size-fix3">
                                    <input type="email" class="form-control text-field-size " id="" placeholder="Email ID"
                                      name="rs_reference_emailid" value="<%=refrenceData.rs_reference_emailid%>">
                                  </div>
                                </div>
                              </div>
      
      
                              <div class="row">
                                <div class="col-sm-12 col-lg-4">
                                  <div class="profile-notes">
                                    <p>May we obtain this reference now?
                                    </p>
                                  </div>
                                </div>
      
                                <div class="col-sm-12 col-lg-2">
                                  <div class="profile-radio">
                                    <label class="radio-inline">
                                      <input type="radio" name="rs_option_obtain_reference" onclick="javascript:yesnoCheck();"
                                        id="yesCheck" value="yes">
                                      &nbsp;Yes&nbsp;&nbsp;
                                    </label>
                                    <label class="radio-inline">
                                      <input type="radio" name="rs_option_obtain_reference" value="no"
                                        onclick="javascript:yesnoCheck();" id="noCheck">
                                      &nbsp;No&nbsp;&nbsp;
                                    </label>
                                  </div>
                                </div>
      
                                <div class="col-sm-12 col-lg-6" id="ifYes">
                                  <div class="input-box-size-fix3">
                                    <input type="text" class="form-control text-field-size " id=""
                                      placeholder="Relationship(One must be work related)" name="rs_reference_relationship">
                                  </div>
                                </div>
                              </div>
                              <div>
                                <input type="hidden" name="ref_id" value="<%=refrenceData._id%>">
                              <button type="submit" class="btn btn-next" style="width: 164px;">
                                Update</button>
                                </div>
                              <%}%>
              </form>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript" src="../js/countrystatecity.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.2/jquery.validate.min.js"
    integrity="sha512-UdIMMlVx0HEynClOIFSyOrPggomfhBKJE28LKl8yR3ghkgugPnG6iLfRfHwushZl1MOPSY6TsuBDGPK2X4zYKg=="
    crossorigin="anonymous"></script>

  </body>
  <script type="text/javascript">
    $('#form5').validate({
      onfocusout: function (element) {
        this.element(element);
      },
      errorClass: 'error_validate',
      errorElement: 'span',
      highlight: function (element, errorClass) {
        $(element).removeClass(errorClass);
      },
      submitHandler: function (form) {
        $('.loader-box').attr('style', 'display:flex !important');
        var formData = $('#form5').serialize();
       
        console.log('formData:', formData)
        $.ajax({
          type: "POST",
          data: formData,
          url: "/api/service_provider_reference",
          cache: false,
          success: function (data) {
            console.log(data);
            if (data.status == false) {
              alert(data.message);
              $('.loader-box').attr('style', 'display:none !important');
              Swal.fire({
                icon: 'error',
                title: data.message,
                showConfirmButton: false,
                confirmButtonColor: '#005377',
                timer: 4000
              })

            } else {
              $('.loader-box').attr('style', 'display:none !important');

              Swal.fire({
                icon: 'success',
                title: data.message,
                showConfirmButton: false,
                confirmButtonColor: '#005377',
                timer: 4000
              })
              if(data.action=='edit'){
                setTimeout(function () {
                //location.reload(true);
                //window.location.href = data.redirect;
                window.location.href = "/signup-professionals-profile-6";
              }, 4000);
              }else{
                setTimeout(function () {
                //location.reload(true);
                window.location.href = "/signup-professionals-profile-6";
              }, 4000);
              }
             

            }
          }
        });


      }
    });
  </script>
  <script type="text/javascript">
    window.onload = function () {
      document.getElementById('ifYes').style.display = 'none';
    }

    function yesnoCheck() {
      if (document.getElementById('yesCheck').checked) {
        document.getElementById('ifYes').style.display = 'block';
        $('.rs_reference_relationship').attr('required',true)
      }
      else if(document.getElementById('noCheck').checked){
        document.getElementById('ifYes').style.display = 'none';
        $('.rs_reference_relationship').attr('required',false)
      }
    }

  </script>
  <script type="text/javascript">
    $(document).ready(function () {
      var flash_msg = $('.flash_msg').html();
      if (flash_msg != "" && flash_msg != undefined) {
        setTimeout(function () { $('.flash_msg').html(''); }, 4000);
      }
    });

    $(document).ready(function () {
      var succ_flash_msg = $('.succ_flash_msg').html();
      if (succ_flash_msg != "" && succ_flash_msg != undefined) {
        setTimeout(function () { $('.succ_flash_msg').html(''); }, 4000);
      }
    });
  </script>
  <script>
    $(document).ready(function () {
      var newHref1 = $('.other_detail_nev').attr('data-href');
        $('.other_detail_nev').attr('href',newHref1);
        var newHref2 = $('.education_detail_nev').attr('data-href');
        $('.education_detail_nev').attr('href',newHref2);
        var newHref3 = $('.employment_detail_nev').attr('data-href');
        $('.employment_detail_nev').attr('href',newHref3);
        var newHref4 = $('.employment_detail_nev').attr('data-href');
        $('.employment_detail_nev').attr('href',newHref4);
        var newHref5 = $('.refrence_detail_nev').attr('data-href');
        $('.refrence_detail_nev').attr('href',newHref5);
        var newHref6 = $('.refrence_detail_nev').attr('data-href');
        $('.refrence_detail_nev').attr('href',newHref6);
      var data = {
        user_id:'<%= session.user_id%>'
      }
     // alert("<%= session.user_id%>")
      $.ajax({
          type: "GET",
          data: data,
          url: "/api/get_service_provider_reference",
          cache: false,
          success: function (data) {
            console.log(data);
            if (data.status == true) {
              
        var newHref7 = $('.indemnity_detail_nev').attr('data-href');
        $('.indemnity_detail_nev').attr('href',newHref7);
        
              $('.rs_reference_fullname').val(data.data.rs_reference_fullname);
              $('.rs_reference_job_title').val(data.data.rs_reference_job_title);
              $('.rs_reference_organisation').val(data.data.rs_reference_organisation);
              $('.rs_reference_postal_code').val(data.data.rs_reference_postal_code);
              $('.rs_reference_address').val(data.data.rs_reference_address);
              $('.rs_reference_telePhoneNumber').val(data.data.rs_reference_telePhoneNumber);
              $('.rs_reference_emailid').val(data.data.rs_reference_emailid);
              $('.ref_id').val(data.data._id);
              if(data.data.rs_option_obtain_reference=='yes'){
                $('.rs_reference_relationship').val(data.data.rs_reference_relationship)
                $("#yesCheck").attr('checked', 'checked');
                document.getElementById('ifYes').style.display = 'block';
               
              }else{
                $('.rs_reference_relationship').val('')
                $("#noCheck").attr('checked', 'checked');
                document.getElementById('ifYes').style.display = 'none';
              }
           

          }
        }
      })

    });
  </script>

  </html>